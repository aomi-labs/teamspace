## Compile-time

### Test Harness
Where you get the scafolding of running Rust code-gen tests:

`/Users/ceciliazhang/Code/baml/engine/generators/languages/go/generated_tests/array_types/analysis.md`

^ from test harness macro expansion

`/Users/ceciliazhang/Code/baml/engine/generators/data/classes/go/main_test.go`
^ Generated by this: `RUN_GENERATOR_TESTS=1 cargo test --package generators-go --lib -- classes`

Gen go code in `engine/generators/data/classes/go`

**test harness** `/Users/ceciliazhang/Code/baml/engine/generators/languages/go/src/lib.rs` 
create_code_gen_test_suites copies data to the actual go integrated test project, with go.mod and .... so that it compiles into test suits:

`/Users/ceciliazhang/Code/baml/engine/target/debug/build/test-harness-6375f96a9bb41699/out/generated_macro.rs`


**Notes**

`/Users/ceciliazhang/Code/baml/engine/.claude/research/go_gen_test_function_call.md`
`/Users/ceciliazhang/Code/baml/engine/.claude/research/go_gen_test_dataflow.md`

### You need to
compile all getnerated_test for Rust, with correct type

## Runtime
CffiValueHolder in Go:
```go
// Efficient encoding to BAML runtime format
func EncodeClass(name func() *cffi.CFFITypeName, fields map[string]any, dynamicFields *map[string]any) (*cffi.CFFIValueHolder, error) {
    // Direct memory-efficient serialization
}

func EncodeEnum(name func() *cffi.CFFITypeName, value string, is_dynamic bool) (*cffi.CFFIValueHolder, error) {
    // Type-safe enum encoding
}

// Decoding from BAML runtime responses
func Decode(holder *cffi.CFFIValueHolder) reflect.Value {
    // Direct deserialization from Rust memory
}
```

We added `crate-type = ["cdylib", "rlib"]` in `/Users/ceciliazhang/Code/baml/engine/language_client_cffi/Cargo.toml`

so that rust inport the CffiValueHolder here `/Users/ceciliazhang/Code/baml/engine/language_client_rust/src/ffi.rs`

- with cdylib u need to `rustc compile --c link this... lib.rs....`
- with rlib u just do `cargo build`

### You need to

impl FromCffiValueHolder for each client type that you code-gen

#### Rust Missing:

- No Encode/Decode methods for CFFI integration
- Types only have ToBamlValue/FromBamlValue for JSON serialization
- No protocol buffer CFFI integration
- Streaming Types System ‚ùå

And more....
